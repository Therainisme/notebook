# sqlx

> 以 MySQL 为例

## 下载依赖

```shell
go get -u github.com/jmoiron/sqlx
go get -u github.com/go-sql-driver/mysql
```

## 创建与数据库对应的结构体

结构体字段标签中 `db:"..."` 双引号内是其在数据库中的字段名。

```go
type User struct {
	Id       string `db:"id"`
	Name     string `db:"name"`
	Email    string `db:"email"`
	Password string `db:"password"`
	Token    string `db:"token"`
}
```

## 全局变量 `db`

```go
var db *sqlx.DB
```

## 创建数据库连接

* user: 数据库用户
* password：数据库用户密码
* host：数据库主机地址
* prot：数据库端口
* database：数据库名
* db.SetMaxOpenConns(200)：设置最大连接数量
* db.SetMaxIdleConns(10)：设置最大连接空闲数量

```go
func InitMySQL() (err error) {
	db, err = sqlx.Open("mysql", "<user>:<password>@tcp(<host>:<port>)/<database>")
	if err != nil {
		fmt.Printf("connect server failed, err:%v\n", err)
		return
	}
	db.SetMaxOpenConns(200)
	db.SetMaxIdleConns(10)
	return
}
```

## 查询操作

### Get 查询一行记录

Get using this DB. Any placeholder parameters are replaced with supplied args. An error is returned if the result set is empty.

```go
func (*sqlx.DB).Get(dest interface{}, query string, args ...interface{}) error
```

示例：

```go
var user User
if err := db.Get(&user, "SELECT * FROM user WHERE name=?", "Therainisme"); err != nil {
	fmt.Printf("get data failed, err:%v\n", err)
	return
}

println(user.Name, user.Email)
```